@page "/plcdashboard"
@namespace PlcTagLib.Web.Pages
@using PlcTagLib.MicrologixPlcs.DTOs


<PageTitle>PLC Dashboard</PageTitle>
<MudCard Elevation="2" Class="col-8 mx-auto align-center" Style="min-width: fit-content">
    <MudCardHeader>
        <MudGrid Style="min-width: fit-content">
            <MudItem xs="12" sm="12" md="8">
                <MudSelect Class="" Label="Micrologix Plcs" T="PlcDto" Variant="Variant.Outlined"
                           ValueChanged="OnValueChanged" Clearable="true">
                    @foreach (var plc in PlcDtosList!)
                    {
                        <MudSelectItem Value="@plc">@plc.Name</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>
            <MudItem xs="12" sm="12" md="4">
                <MudAutocomplete Label="Tags" T="string" Variant="Variant.Outlined"/>
            </MudItem>
        </MudGrid>
    </MudCardHeader>
    <MudCardContent>
        <MudList Clickable="true" Dense="true" Class="">
            @if (TagGroupsList != null)
            {
                foreach (var tagGroup in TagGroupsList)
                {
                    <MudDivider DividerType="DividerType.FullWidth"/>
                    <MudListItem Text="@tagGroup.Key.ToString()" Style="background-color: var(--mud-palette-drawer-background);">
                        <NestedList>
                            <MudSimpleTable Dense="true" Bordered="true" Striped="false" FixedHeader="true" Outlined="true">
                                <thead>
                                <tr>
                                    <th style="width: 10%" class="text-center"> <MudButton Size="Size.Small" Variant="Variant.Outlined">Enable</MudButton></th>
                                    <th style="width: 15%;" class="text-center">I/O</th>
                                    <th style="width: 35%;" class="text-center">Address</th>
                                    <th style="width: auto" class="text-center">Symbol</th>
                                </tr>
                                </thead>
                                <tbody>
                                @foreach (var tag in tagGroup)
                                {
                                    <tr>
                                        <td class="text-center">
                                            <MudCheckBox @bind-Checked="tag.TagRowEnabled"></MudCheckBox>
                                        </td>
                                        <td style="" class="text-center">
                                            <MudButton Style="width: 60%;" Class="justify-space-between"
                                                       Disabled="@(!tag.TagRowEnabled)"
                                                       StartIcon="@Icons.Material.Filled.Circle"
                                                       IconColor="@(tag.Value ? Color.Error : Color.Success)"
                                                       Variant="Variant.Outlined"
                                                       Size="Size.Small"
                                                       OnClick="@(() => StartMonitoringTagValueAsync(tag))">
                                                @(tag.Value ? "Off" : "on")
                                            </MudButton>
                                        </td>
                                        <td class="text-center">@tag.Address</td>
                                        <td class="text-center">@tag.SymbolName</td>
                                    </tr>
                                }
                                </tbody>
                            </MudSimpleTable>
                        </NestedList>
                    </MudListItem>

                }
            }
        </MudList>
    </MudCardContent>
</MudCard>

@code {

}