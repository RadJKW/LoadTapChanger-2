@page "/plcdashboard"
@namespace PlcTagLib.Web.Pages
@using PlcTagLib.MicrologixPlcs.DTOs


<PageTitle>PLC Dashboard</PageTitle>
<MudCard Elevation="2" Class="col-8 mx-auto align-center" Style="min-width: fit-content">
    <MudCardHeader>
        <MudGrid Style="min-width: fit-content">
            <MudItem xs="12" sm="12" md="8">
                <MudSelect Label="Micrologix Plcs" T="PlcDto" Variant="Variant.Outlined"
                           ValueChanged="OnValueChanged" Clearable="true">
                    @foreach (var plc in PlcDtosList!)
                    {
                        <MudSelectItem Value="@plc">@plc.Name</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>
            <MudItem xs="12" sm="12" md="4">
                <MudAutocomplete Label="Tags" T="string" Variant="Variant.Outlined"/>
            </MudItem>
        </MudGrid>
    </MudCardHeader>
    <MudCardContent>
        <MudList Clickable="true" Dense="true" Class="">
            @if (TagGroupsList != null)
            {
                foreach (var tagGroup in TagGroupsList)
                {
                    <MudDivider DividerType="DividerType.FullWidth"/>
                    <MudListItem Text="@tagGroup.Key.ToString()" Style="background-color: #0a0a0a5e;">
                        <NestedList>
                            <MudSimpleTable Dense="true" Bordered="true" Striped="false"
                                            FixedHeader="true" Outlined="true">
                                <thead>
                                <tr>
                                    <th style="width: 10%" class="text-center">
                                        <MudButton Size="Size.Small" Variant="Variant.Outlined">
                                            Enable
                                        </MudButton>
                                    </th>
                                    <th style="width: 15%;" class="text-center">I/O</th>
                                    <th style="width: 35%;" class="text-center">Address</th>
                                    <th style="width: auto" class="text-center">Symbol</th>
                                </tr>
                                </thead>
                                <tbody>
                                @foreach (var tagRow in tagGroup)
                                {
                                    <tr>
                                        <td class="text-center">
                                            <MudCheckBox T="bool" CheckedChanged="(args) => OnCheckedChanged(args, tagRow)"/>
                                        </td>
                                        <td style="" class="text-center">
                                            <MudButton Style="width: 60%;" Class="justify-space-between"
                                                       Disabled="@(!tagRow.TagMonitoringEnabled)"
                                                       StartIcon="@Icons.Material.Filled.Circle"
                                                       IconColor="@(tagRow.BitValue ? Color.Error : Color.Success)"
                                                       Variant="Variant.Outlined"
                                                       Size="Size.Small"
                                                       OnClick="() => tagRow.WriteToTagAsync(!tagRow.BitValue)">
                                                @(tagRow.IntValue!.ToString())
                                            </MudButton>
                                        </td>
                                        <td class="text-center">@tagRow.Address</td>
                                        <td class="text-center">@tagRow.SymbolName</td>
                                    </tr>
                                }
                                </tbody>
                            </MudSimpleTable>
                        </NestedList>
                    </MudListItem>
                }
            }
        </MudList>
    </MudCardContent>
</MudCard>
