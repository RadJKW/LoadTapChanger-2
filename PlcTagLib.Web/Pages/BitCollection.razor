@page "/bit-collection"
@using PlcTagLib.Services
@inject IBitCollectionService BitCollectionService

<style>
 
        .bit-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            justify-items: center;
            grid-auto-flow: row;
            gap: 15px;
            max-width: calc((8*150px) + (7*15px) + (2*10px));
            padding: 10px;
        }       
    
        .bit-button {
            width: 100%;
            height: 100%;
        }
        .header-buttons{
        display: flex;
        flex: auto;
        justify-content: space-between;
        width:  100%;
        min-width: fit-content;
        }
        .header-left-button {
        float: left ;            
        } 
        .header-right-button{
        float: right;
        }
</style>
<MudCard Class="col-8 mx-auto">
    <MudCardHeader Class="flex-column">
        <MudText Typo="Typo.h3" Align="Align.Center" GutterBottom="true">Bit Monitor</MudText>
        <div class="header-buttons">
            <MudButton Class="header-left-button" Variant="Variant.Outlined" StartIcon="@Icons.Material.Filled.Circle"
                       IconColor="@(IsBitTogglerRunning ? Color.Success : Color.Error)"
                       OnClick="ToggleBitToggler">
                @(IsBitTogglerRunning ? "Stop" : "Start") BitToggler
            </MudButton>
            <MudButton Class="header-right-button" Variant="Variant.Outlined" StartIcon="@Icons.Material.Filled.Circle"
                       IconColor="@(IsBitTogglerRunning ? Color.Success : Color.Error)">
                @(IsBitTogglerRunning ? "Stop" : "Start") BitToggler
            </MudButton>
        </div>
        <MudDivider/>
    </MudCardHeader>
    <MudCardContent>


        <div class="bit-buttons">


            <MudButton Class="bit-button" Variant="Variant.Outlined" StartIcon="@Icons.Material.Filled.Circle" IconColor="@(IsBitTogglerRunning ? Color.Success : Color.Error)"
                       OnClick="ToggleBitToggler">
                @(IsBitTogglerRunning ? "Stop" : "Start") BitToggler
            </MudButton>

        </div>
    </MudCardContent>
</MudCard>

@code {
    private bool IsBitTogglerRunning { get; set; }
    private void ToggleBitToggler()
    {
        if (IsBitTogglerRunning)
        {
    // Stop the bit toggler if it is running
            BitCollectionService.StopBitToggler();
            IsBitTogglerRunning = false;
        }
        else
        {
    // Start the bit toggler if it is not running
            BitCollectionService.StartBitToggler(1000);
            IsBitTogglerRunning = true;
        }
    }
}