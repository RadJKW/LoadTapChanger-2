@using MudBlazor.Utilities
@inherits LayoutComponentBase
@inject NavigationManager Navigator

<MudThemeProvider Theme="MyCustomTheme" @ref="_mudThemeProvider" @bind-IsDarkmode="@_isDarkMode"/>
<MudDialogProvider
    FullWidth="true"
    MaxWidth="MaxWidth.Medium"
    CloseButton="true"
    DisableBackdropClick="true"
    NoHeader="false"
    Position="DialogPosition.Center"
    CloseOnEscapeKey="true"/>
<MudSnackbarProvider/>

<MudLayout>

    <MudAppBar Elevation="0">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start"
                       OnClick="@(_ => DrawerToggle())"/>
        <MudSpacer/>
        @*display the current PAGE TITLE *@

        <MudText Typo="Typo.h6" Style="text-wrap: none">
            @(PageTitle)
        </MudText>

        <MudSpacer/>
        <MudIconButton Icon="@Icons.Custom.Brands.MudBlazor" Color="Color.Inherit" Link="https://mudblazor.com/"
                       Target="_blank">
        </MudIconButton>
        <MudIconButton Icon="@Icons.Custom.Brands.GitHub" Color="Color.Inherit"
                       Link="https://github.com/MudBlazor/MudBlazor/" Target="_blank">
        </MudIconButton>
    </MudAppBar>

    <MudDrawer @bind-Open="_drawerOpen" Elevation="6" Variant="DrawerVariant.Responsive">
        <MudDrawerHeader>
            <MudText Typo="Typo.h6">
                MudBlazorTest
            </MudText>
        </MudDrawerHeader>
        <NavMenu/>
        <MudSpacer/>
        <MudDivider/>

        <MudSwitch Class="justify-center" @bind-Checked="@_isDarkMode" Color="Color.Primary" T="bool" Label="Dark Mode">
        </MudSwitch>
    </MudDrawer>

    <MudMainContent>
        <MudContainer Class="my-8 px-16" MaxWidth="MaxWidth.False">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code {
    bool _drawerOpen;
    private bool _isDarkMode = true;
    private MudThemeProvider? _mudThemeProvider;

    private string PageTitle { get; set; } = "MudBlazorTest";

    private static readonly MudTheme MyCustomTheme = new()
    {
        Palette = new Palette()
        {

            AppbarText = "#424242",
            AppbarBackground = "rgba(0,0,0,0)",
            BackgroundGrey = "#F9FAFC",
            TextSecondary = "#425466",
            Dark = "#110E2D",
            DarkLighten = "#1A1643",
            GrayDefault = "#4B5563",
            GrayLight = "#9CA3AF",
            GrayLighter = "#adbdccff"
        },
        PaletteDark = new PaletteDark()
        {
            Primary = "#7e6fff",
            Surface = "#1e1e2d",
            Background = "#1a1a27",
            BackgroundGrey = "#151521",
            AppbarText = "#92929f",
            AppbarBackground = "rgba(26,26,39,0.8)",
            DrawerBackground = "#1a1a27",
            ActionDefault = "#74718e",
            ActionDisabled = "#9999994d",
            ActionDisabledBackground = "#605f6d4d",
            TextPrimary = "#b2b0bf",
            TextSecondary = "#92929f",
            TextDisabled = "#ffffff33",
            DrawerIcon = "#92929f",
            DrawerText = "#92929f",
            GrayLight = "#2a2833",
            GrayLighter = "#1e1e2d",
            Info = "#4a86ff",
            Success = "#3dcb6c",
            Warning = "#ffb545",
            Error = "#ff3f5f",
            LinesDefault = "#33323e",
            TableLines = "#33323e",
            Divider = "#a1a1a1",
            OverlayLight = "#1e1e2d80"



        },
        LayoutProperties = new LayoutProperties()
        {
            DrawerMiniWidthLeft = "20px",
            DrawerMiniWidthRight = "20px",
            DrawerWidthLeft = "240px",
            DrawerWidthRight = "300px"
        }
    };

    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;

    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _isDarkMode = await _mudThemeProvider!.GetSystemPreference();
    // Navigator.NavigateTo("plcdashboard");
        }

    // StateHasChanged();

    }

    // after the route changes, update the page title
    protected override void OnParametersSet()
    {
        var title = Navigator.Uri.Split('/').Last();
        PageTitle = title == "plcdashboard" ? "PLC-Dashboard" : "MudBlazorTest";

    }
}