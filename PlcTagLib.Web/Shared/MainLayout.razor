@inherits LayoutComponentBase
@inject NavigationManager Navigator
@using MudBlazor.Utilities
<style>
    .selected {
        background-color: #1E88E5 !important;
    }

    .selected>td {
        color: white !important;
    }

    .selected>td .mud-input {
        color: white !important;
    }
</style>

<MudThemeProvider Theme="_myCustomTheme" @ref="_mudThemeProvider" @bind-IsDarkmode="@_isDarkMode" />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>

    <MudAppBar Elevation="0">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start"
            OnClick="@(e => DrawerToggle())" />
        <MudSpacer />
        @*display the current PAGE TITLE *@

        <MudText Typo="Typo.h6" Class="mud-toolbar-title" NoWrap="true">
            @(PageTitle)</MudText>

        <MudSpacer />
        <MudIconButton Icon="@Icons.Custom.Brands.MudBlazor" Color="Color.Inherit" Link="https://mudblazor.com/"
            Target="_blank">
        </MudIconButton>
        <MudIconButton Icon="@Icons.Custom.Brands.GitHub" Color="Color.Inherit"
            Link="https://github.com/MudBlazor/MudBlazor/" Target="_blank">
        </MudIconButton>
    </MudAppBar>

    <MudDrawer @bind-Open="_drawerOpen" Elevation="6" Variant="DrawerVariant.Responsive">
        <MudDrawerHeader Style="background-color: #1a1a26a6">
            <MudText Typo="Typo.h6">
                MudBlazorTest
            </MudText>
        </MudDrawerHeader>
        <NavMenu />
        <MudSpacer />
        <MudDivider />

        <MudSwitch Class="justify-center" @bind-Checked="@_isDarkMode" Color="Color.Primary" T="bool" Label="Dark Mode">
        </MudSwitch>
    </MudDrawer>

    <MudMainContent>
        <MudContainer Class="my-8 px-16" MaxWidth="MaxWidth.False">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code {
    bool _drawerOpen = false;
    private bool _isDarkMode = true;
    private MudThemeProvider? _mudThemeProvider;

    private string PageTitle { get; set; } = "MudBlazorTest";

    readonly MudTheme _myCustomTheme = new MudTheme()
    {
        Palette = new Palette()
        {
            Primary = Colors.Blue.Default,
            Secondary = Colors.Green.Accent4,
            AppbarBackground = Colors.Red.Default,
        },
        PaletteDark = new PaletteDark()
        {
            Primary = Colors.Blue.Lighten1,
            Background = "#151520",
            AppbarBackground = "#1a1a27cc",
            DrawerBackground = "#1A1A26",
            Surface = "#1e1e2d",
            TableStriped = "#222233F5",



        },

        LayoutProperties = new LayoutProperties()
        {
            DrawerMiniWidthLeft = "20px",
            DrawerMiniWidthRight = "20px",
            DrawerWidthLeft = "240px",
            DrawerWidthRight = "300px"
        }
    };

    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;

    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _isDarkMode = await _mudThemeProvider!.GetSystemPreference();
            // Navigator.NavigateTo("plcdashboard");
        }

        // StateHasChanged();

    }

    // after the route changes, update the page title
    protected override void OnParametersSet()
    {
        var title = Navigator.Uri.Split('/').Last();
        if (title == "plcdashboard")
        {
            PageTitle = "PLC-Dashboard";
        }
        else
        {
            PageTitle = "MudBlazorTest";
        }


    }
}